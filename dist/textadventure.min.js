/*! js-tap-adventure 2015-03-12 */
!function(a){a.textadventure=function(b,c){var d={jsonfile:"questions.json",questionClass:["row","col-sm-8 col-sm-offset-2"],buttonClass:"btn btn-default btn-block",imgClass:"img-responsive center-block",questionIndex:0,scroll:!0,scrollSpeed:1200,scrollTopPad:.1,goback:!0,reset:!0},e=a(b),f=this;f.settings=a.extend({},d,c),f.init=function(a){f.data=a,n(),f.questionIds=[],g(),m()};var g=function(){f.data.questions.forEach(function(a){f.questionIds.push(a.id)})},h=function(b){b.find("button").on("click",function(){var b=a(this).data("goto"),c=f.questionIds.indexOf(b);-1!==c?(f.settings.questionIndex=c,m()):(b=b.toString(),f.settings.goback===!0&&"goback"===b.toLowerCase()&&i(),f.settings.reset===!0&&"reset"===b.toLowerCase()&&j())})},i=function(){e.children().last().remove(),e.children().last().addClass("active").find("button").removeClass("disabled"),l(e.children().last().offset().top)},j=function(){e.children().remove(),l(0),f.settings.questionIndex=0,m()},k=function(){e.css("min-height",2*a(window).height()+a(window).scrollTop())},l=function(b){f.settings.scroll&&(k(),a("body, html").animate({scrollTop:b-a(window).height()*f.settings.scrollTopPad},{queue:!1,duration:f.settings.scrollSpeed,easing:"easeInOutQuint",complete:function(){k()}}))},m=function(){e.children().length>0&&(e.find("button").addClass("disabled"),e.children().last().removeClass("active"));for(var b=e.append(a("<div />").attr("class",f.settings.questionClass[0]+" question active")).children().last(),c=1;c<f.settings.questionClass.length;c++)b=b.append(a("<div />").attr("class",f.settings.questionClass[c])).children().last();"image"in f.data.questions[f.settings.questionIndex]&&f.data.questions[f.settings.questionIndex].image.length>0&&a("<img />").attr("src",f.data.questions[f.settings.questionIndex].image).attr("class",f.settings.imgClass).appendTo(b);a("<p />").html(f.data.questions[f.settings.questionIndex].text).appendTo(b);return"options"in f.data.questions[f.settings.questionIndex]?(f.data.questions[f.settings.questionIndex].options.forEach(function(c){a("<button />").attr("class",f.settings.buttonClass).text(c.text).data("goto",c["goto"]).appendTo(b)}),0!==f.settings.questionIndex&&l(b.offset().top),void h(b)):(l(b.offset().top),!1)},n=function(){jQuery.easing.easeInOutQuint=function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b*b+c:d/2*((b-=2)*b*b*b*b+2)+c}};a.ajax({url:f.settings.jsonfile,dataType:"json"}).fail(function(a,b,c){console.log(b,c)}).done(function(a){f.init(a)})},a.fn.textadventure=function(b){return this.each(function(){if(void 0===a(this).data("textadventure")){var c=new a.textadventure(this,b);a(this).data("textadventure",c)}})}}(jQuery);